
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>OnPlay: посмотри видео вместе с друзьями</title>
        <link rel="stylesheet" href="http://getbootstrap.com/dist/css/bootstrap.min.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <style>
.centered {
	text-align:center;
}

div.brand {
	width:300px;
	margin:0 auto;
	text-align:center;
}

div.brand>h2 {
	color:#8c8c8c;
	font-size:22px;
	line-height:1.4;
	margin-top:-2px;
}

div.input-url, div.room-url {
	float:none;
	margin:0 auto;
	padding-top:.6%;
	padding-bottom:.6%;
}

div.input-url>label, div.room-url>label {
	padding:.5%;
	color:#8c8c8c;
}

div.room-url>p {
	font-size:24px;
}

div.room-url>p:last-child {
	margin-bottom:0;
}

div.room-url>p>span{
	color:#29A8DA;
}
       </style>

	<script type="text/javascript">
    var socket;
    if (!window.WebSocket) {
      window.WebSocket = window.MozWebSocket;
    }
    if (window.WebSocket) {
      socket = new WebSocket("ws://" + window.location.host + "${websocket-location}");
      socket.onmessage = function(event) {
      var parsed = JSON.parse(event.data);
      if(parsed.method == "RoomLink"){
        var result = document.getElementById('result');
        result.innerHTML = window.location + "room/"+ parsed.value;
        var resultLink = document.getElementById('result-link');
        resultLink.href = "/room/"+ parsed.value;
        window.location.href = window.location + "room/"+ parsed.value;
        }
      };
      socket.onopen = function(event) {
      };
      socket.onclose = function(event) {
      };
    } else {
      alert("Your browser does not support Web Socket.");
    }
    function send(message) {
      if (!window.WebSocket) { return; }
      if (socket.readyState == WebSocket.OPEN) {
        socket.send(message);
      } else {
        alert("The socket is not open.");
      }
    }
    function sendId() {
	var parser = document.createElement('a');
	parser.href = document.getElementById('link').value;
	var result = document.getElementById('result').innerHTML;
	if(parser.href.indexOf('youtube') > -1){
	result = parseId(endsWith(parser.href));
	}
	else if(parser.href.indexOf('vimeo') > -1){
	result = parseId(endsWith(parser.pathname));
	}
	else{

	}
	if(result.length > 0 && result !== 'Неправильная ссылка'){
	send(JSON.stringify({'method' : 'VideoId', 'value': result}));
	}
}
    function endsWith(str){
    if(str.lastIndexOf("/") == str.length - 1){
    return str.substring(0, str.length - 2);
    }
    else{
    return str;
    }
    }
    function parseId(str){
    if(str.indexOf("youtube") > -1){
    var vYT = str.indexOf('v=') + 2;
    var substr = str.substring(vYT);
    if(substr.indexOf('&') > -1){
    var ampYT = substr.indexOf('&');
    substr = substr.substring(0, ampYT);
    }
    return substr;
    }
    else if(str.indexOf("vimeo") > -1){
    var out = str.substring(str.lastIndexOf("/") + 1);
    return out;
    }
    else{
    return 'Неправильная ссылка';
    }
    }
</script>
    <!--script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
         
         ga('create', 'UA-59019290-1', 'auto');
         ga('send', 'pageview');
         
        </script>
    <script type="text/javascript">
        (function (d, w, c) {
         (w[c] = w[c] || []).push(function() {
                                  try {
                                  w.yaCounter28113357 = new Ya.Metrika({
                                                                       id:28113357,
                                                                       webvisor:true
                                                                       });
                                  } catch(e) { }
                                  });
         
         var n = d.getElementsByTagName("script")[0],
         s = d.createElement("script"),
         f = function () { n.parentNode.insertBefore(s, n); };
         s.type = "text/javascript";
         s.async = true;
         s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";
         
         if (w.opera == "[object Opera]") {
         d.addEventListener("DOMContentLoaded", f, false);
         } else { f(); }
         })(document, window, "yandex_metrika_callbacks");
        </script-->
    </head>

    <body>
    <div class="container-fluid" style="padding-top: 15px;">
        <div class="row">
   			<div class="brand">
                <svg xmlns="http://www.w3.org/2000/svg" width="300" height="150">
                    <g>
                        <title>background</title>
                        <rect x="-1" y="-1" width="302" height="152" id="canvas_background" fill="none"/>
                        <g id="canvasGrid" display="none">
                            <rect id="svg_1" width="100%" height="100%" x="0" y="0" stroke-width="0" fill="url(#gridpattern)"/>
                        </g>
                    </g>

                    <g>
                        <title>Layer 1</title>
                        <g stroke="null" id="svg_2">
                            <ellipse stroke="#ffffff" fill="#24b7f2" stroke-width="2" cx="202.55675" cy="75.75575" id="svg_6" rx="71.88075" ry="71.88075" stroke-dasharray="15,5"/>
                            <line stroke="#ffffff" fill="none" stroke-width="4" x1="175.45416" y1="34.98405" x2="184.88114" y2="126.89714" id="svg_10" stroke-linejoin="null" stroke-linecap="null"/>
                            <line stroke="#ffffff" fill="none" stroke-width="4" x1="175.45416" y1="35.4554" x2="242.85709" y2="73.16333" id="svg_12" stroke-linejoin="null" stroke-linecap="null"/>
                            <line stroke="#ffffff" fill="none" stroke-width="4" x1="241.91439" y1="72.69198" x2="185.35249" y2="123.59769" id="svg_13" stroke-linejoin="null" stroke-linecap="null"/>
                            <text stroke="#000000" fill="#24b7f2" stroke-width="0" stroke-dasharray="10,5" x="10.41923" y="30.61989" id="svg_16" font-size="24" font-family="Helvetica, Arial, sans-serif" text-anchor="left" xml:space="preserve" transform="matrix(3.708923733934442,0,0,3.6877370085994152,-14.609681859481817,-10.511896033586673) ">on</text>
                        </g>
                    </g>
                </svg>
                <h1>OnPlay</h1>
               	<h2>cинхронный просмотр видео вместе с друзьями</h2>
			</div>                     
   		</div>
 
        <div class="row">
  			<div class="input-url col-lg-7 col-xs-12">
   				<div class="input-group input-group-lg">
	   				<span class="input-group-addon" id="basic-addon1">url</span>
	   				<input type="text" class="form-control" placeholder="Ссылка на видео с vimeo" aria-describedby="Ссылка на видео с vimeo" id="link">
	   				<span class="input-group-btn"><button class="btn btn-default" type="button" id="send" onclick="sendId()">></button></span>
	   			</div>
	   			<label class="visible-lg-block visible-md-block" align="center">Вставьте ссылку на видео, которое хотите синхронно посмотреть с друзьями, в это поле, а мы позаботимся об остальном.</label>
			</div>

        </div>

   		<div class="row">
            <hr>
        </div>

        <div class="row">
  			<div class="room-url col-lg-7 col-xs-12 centered">
  				<p>Отправьте эту ссылку друзьям и нажмите кнопку: <br /><span id="result">вставьте ссылку в поле выше</span></p>
  				<a id="result-link" href=""><button class="btn btn-default btn-lg" type="button">>>> Перейти к просмотру <<<</button></a>
  			</div>
  		</div>

        <div class="row">
            <hr>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <p class="text-muted">© OnPlay, 2015 </p>
            </div>
        </div>

    </div>
    <script type="text/javascript">
    var reformalOptions = {
        project_id: 850985,
        project_host: "onplayme.reformal.ru",
        tab_orientation: "left",
        tab_indent: "50%",
        tab_bg_color: "#F05A00",
        tab_border_color: "#FFFFFF",
        tab_image_url: "http://tab.reformal.ru/T9GC0LfRi9Cy0Ysg0Lgg0L%252FRgNC10LTQu9C%252B0LbQtdC90LjRjw==/FFFFFF/2a94cfe6511106e7a48d0af3904e3090/left/1/tab.png",
        tab_border_width: 2
    };

    (function() {
        var script = document.createElement('script');
        script.type = 'text/javascript'; script.async = true;
        script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'media.reformal.ru/widgets/v3/reformal.js';
        document.getElementsByTagName('head')[0].appendChild(script);
    })();
</script><noscript><a href="http://reformal.ru"><img src="http://media.reformal.ru/reformal.png" /></a><a href="http://onplayme.reformal.ru">Oтзывы и предложения для OnPlay.me</a></noscript>
</body>
</html>